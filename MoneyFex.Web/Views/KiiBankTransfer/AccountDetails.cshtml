@{
    ViewData["Title"] = "KiiBank Account Details";
    Layout = "_Layout";
}

<div class="real_form pattern2 pdt40">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3">
                <div class="login_signup nopadding mb50 clearfix text-center">
                    <h3 class="mt20">KiiBank account deposit</h3>
                    <hr>
                    <div class="pinside50 pdt10 pdb20">
                        <div class="form-group">
                            <input type="text" 
                                   placeholder="Enter account or telephone number" 
                                   name="AccountNumber" 
                                   id="AccountNumber" 
                                   class="form-control form-blue" 
                                   value="@(ViewBag.AccountNo ?? "")">
                            <span class="text-danger" id="ErrorMessage"></span>
                        </div>
                    </div>
                    <button onclick="Confirm();" class="btn btn-primary btn-lg">
                        Confirm account
                    </button>
                    <!-- back btn -->
                    <hr>
                    <div class="clearfix mb20">
                        <a href="javascript:history.back()" class="">
                            <i class="fa fa-chevron-left" aria-hidden="true"></i> Go Back
                        </a>
                    </div>
                    <!-- back btn end-->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade text-center" id="unregistered-number" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">This number is not registered with KiiBank!</h4>
            </div>
            <div class="modal-body">
                We will send a message requesting them to open an account with us before they can receive the money
                you're about to send to them.
                <p></p>
                <p>
                    Do you still want to continue with this transfer?
                </p>
            </div>
            <div class="modal-footer text-center">
                <a onclick="ValidateAccount()" class="btn btn-primary">Yes</a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        function Confirm() {
            // BYPASS VALIDATION - Directly proceed with static values
            var accountNumber = $('#AccountNumber').val();
            
            // Use provided account number or default static value
            if (!accountNumber || accountNumber.trim() === '') {
                accountNumber = "1234567890"; // Default static value
            }

            // Call endpoint to set static values in session (bypasses actual validation)
            $.getJSON("/KiiBankTransfer/ValidateAccountNumber?accountNumber=" + encodeURIComponent(accountNumber),
                function (result) {
                    if (result.Status == 1) {
                        $("#ErrorMessage").text("");
                        // Redirect to next page immediately
                        ValidateAccount();
                    }
                    else {
                        // Even on error, proceed with static values
                        $("#ErrorMessage").text("");
                        ValidateAccount();
                    }
                })
                .fail(function() {
                    // Even on failure, proceed with static values
                    $("#ErrorMessage").text("");
                    ValidateAccount();
                });
        }

        function ValidateAccount() {
            window.location.href = "/KiiBankTransfer/ValidateAccount";
        }

        // Allow Enter key to trigger confirmation
        $('#AccountNumber').on('keypress', function(e) {
            if (e.which === 13) {
                e.preventDefault();
                Confirm();
            }
        });
    </script>
}
